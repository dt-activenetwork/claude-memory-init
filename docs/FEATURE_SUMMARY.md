# Remote Sync Feature Summary

## Overview

æœ¬æ¬¡æ›´æ–°ä¸º claude-memory-init æ·»åŠ äº†è¿œç¨‹ä»“åº“æ”¯æŒå’Œå›¢é˜Ÿåä½œåŠŸèƒ½ï¼Œä½¿å¾—å›¢é˜Ÿå¯ä»¥å…±äº«ç³»ç»Ÿæç¤ºè¯æ¨¡æ¿ï¼ŒåŒæ—¶ä¿æŒé¡¹ç›®ç‰¹å®šçš„è¯­ä¹‰è®°å¿†æœ¬åœ°åŒ–ã€‚

## æ ¸å¿ƒæ”¹è¿›

### 1. è‡ªåŠ¨ä¸´æ—¶ç›®å½•ç®¡ç†ï¼ˆç”¨æˆ·ä¸å¯è§ï¼‰

**å®ç°ï¼š**
- ä½¿ç”¨ `os.tmpdir()` ç”Ÿæˆç³»ç»Ÿä¸´æ—¶ç›®å½•è·¯å¾„
- éšæœºç”Ÿæˆå”¯ä¸€ç›®å½•åï¼š`/tmp/claude-memory-{random-hex}/`
- æ‰€æœ‰è¿œç¨‹æ“ä½œåœ¨ tmp ä¸­å®Œæˆ
- æ“ä½œå®Œæˆåè‡ªåŠ¨æ¸…ç†ï¼Œä¸æ±¡æŸ“ç”¨æˆ·å·¥ä½œç›®å½•

**å¥½å¤„ï¼š**
- ç”¨æˆ·æ— éœ€å…³å¿ƒä¸´æ—¶æ–‡ä»¶ä½ç½®
- è·¨å¹³å°æ”¯æŒï¼ˆLinux/macOS/Windowsï¼‰
- é¿å…æƒé™é—®é¢˜
- è‡ªåŠ¨æ¸…ç†ï¼Œä¸ç•™åƒåœ¾æ–‡ä»¶

### 2. è¿œç¨‹ä»“åº“åˆå§‹åŒ–

**å‘½ä»¤ï¼š**
```bash
claude-memory-init init --quick --repo https://github.com/team/memory-repo.git
```

**æµç¨‹ï¼š**
1. å…‹éš†è¿œç¨‹ä»“åº“åˆ° `/tmp/claude-memory-xxxxx/`ï¼ˆä½¿ç”¨ `--depth 1` åŠ é€Ÿï¼‰
2. ä» tmp å¤åˆ¶æ¨¡æ¿åˆ°é¡¹ç›®çš„ `claude/` ç›®å½•
3. æ‰§è¡Œæ­£å¸¸çš„åˆå§‹åŒ–æµç¨‹ï¼ˆæ¨¡æ¿æ¸²æŸ“ç­‰ï¼‰
4. è‡ªåŠ¨åˆ é™¤ tmp ç›®å½•

**å‘åå…¼å®¹ï¼š**
- ä¸æä¾› `--repo` æ—¶ï¼Œä»ä½¿ç”¨æœ¬åœ° `mem/` ç›®å½•
- ç°æœ‰å·¥ä½œæµä¸å—å½±å“

### 3. æ™ºèƒ½åŒæ­¥å’Œ PR åˆ›å»º

**å‘½ä»¤ï¼š**
```bash
# æ£€æŸ¥å·®å¼‚
claude-memory-init sync --repo https://github.com/team/memory-repo.git

# åˆ›å»º PR
claude-memory-init sync --repo https://github.com/team/memory-repo.git --pr
```

**æ ¸å¿ƒé€»è¾‘ï¼š**

#### a. æ™ºèƒ½è¿‡æ»¤
- âœ… **åŒ…å«**ï¼š`prompt/` ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼ˆç³»ç»Ÿæç¤ºè¯ï¼‰
- âŒ **æ’é™¤**ï¼š`memory/semantic/` ï¼ˆé¡¹ç›®ç‰¹å®šçš„è¯­ä¹‰è®°å¿†ï¼‰
- âŒ **æ’é™¤**ï¼š`memory/episodic/` ï¼ˆå¯¹è¯å†å²ï¼‰
- âŒ **æ’é™¤**ï¼šå…¶ä»–ç›®å½•

**åŸå› ï¼š**
- ç³»ç»Ÿæç¤ºè¯æ˜¯å¯å¤ç”¨çš„å›¢é˜Ÿæ¨¡æ¿
- è¯­ä¹‰è®°å¿†æ˜¯é¡¹ç›®ç‰¹å®šçŸ¥è¯†ï¼Œä¸åº”å…±äº«
- åªæœ‰ç²¾å¿ƒç­–åˆ’çš„å†…å®¹æ‰åº”è¯¥è¿›å…¥ PR å®¡æŸ¥æµç¨‹

#### b. æ™ºèƒ½åˆ†æ”¯å‘½å

**æ ¼å¼ï¼š** `sp-{hash}`

**ç¤ºä¾‹ï¼š** `sp-a1b2c3d4`

**å®ç°ï¼š**
1. ä» git config è·å– `user.name`ï¼Œè½¬å°å†™ï¼Œç©ºæ ¼æ›¿æ¢ä¸ºè¿å­—ç¬¦
2. ä½¿ç”¨å½“å‰æ—¥æœŸ YYYYMMDD æ ¼å¼
3. ä»ä¿®æ”¹çš„æ–‡ä»¶åæå–æ¸…æ´æ–‡ä»¶åï¼ˆå»é™¤åºå·å’Œæ‰©å±•åï¼‰
   - `1.objectives.md` â†’ `objectives`
   - `2.assumptions.md` â†’ `assumptions`
   - `0.overview.md` â†’ `overview`
4. æ‹¼æ¥ï¼š`{username}-{date}-{clean-filenames}`
5. ç”Ÿæˆ MD5 hashï¼Œå–å‰8ä½
6. æ·»åŠ  `sp-` å‰ç¼€ï¼ˆSystem Promptï¼‰

**å¥½å¤„ï¼š**
- ç®€çŸ­æ˜“è¯»ï¼Œé€‚åˆå‘½ä»¤è¡Œæ“ä½œ
- åŸºäºå†…å®¹çš„ hashï¼Œç›¸åŒå†…å®¹ç”Ÿæˆç›¸åŒåˆ†æ”¯å
- é¿å…åˆ†æ”¯åè¿‡é•¿çš„é—®é¢˜
- `sp-` å‰ç¼€æ¸…æ™°æ ‡è¯†ä¸ºç³»ç»Ÿæç¤ºè¯æ›´æ–°

#### c. è¯¦ç»†çš„æäº¤ä¿¡æ¯

```
Add/Update system memory prompts

Author: John Smith <john@example.com>
Date: 2025-01-07

System memory files updated:
- prompt/0.overview.md
- prompt/1.objectives.md
- prompt/2.assumptions.md

This PR contains system prompt updates generated during AI-assisted development.
Please review for accuracy and merge if approved.

Generated by claude-memory-init
```

**åŒ…å«ä¿¡æ¯ï¼š**
- ä½œè€…å§“åå’Œé‚®ç®±ï¼ˆä» git configï¼‰
- æ—¥æœŸ
- å®Œæ•´çš„æ–‡ä»¶åˆ—è¡¨
- æ¸…æ™°çš„æè¿°

#### d. PR æ ‡ç­¾

æ‰€æœ‰ç³»ç»Ÿæç¤ºè¯ PR ä½¿ç”¨ç»Ÿä¸€çš„å•ä¸€æ ‡ç­¾ï¼š

**æ ‡ç­¾ï¼š** `system-prompt-update`

**ä¼˜åŠ¿ï¼š**
- ç®€å•æ˜äº†ï¼Œæ˜“äºè¯†åˆ«
- ç»Ÿä¸€æ ‡å‡†ï¼Œæ–¹ä¾¿è¿‡æ»¤
- å‡å°‘æ ‡ç­¾ç®¡ç†å¤æ‚åº¦
- æ¸…æ™°æ ‡è¯†ç³»ç»Ÿæç¤ºè¯æ›´æ–°

#### e. ç”¨æˆ·å‹å¥½çš„è¾“å‡º

```
ğŸ”„ Syncing memory repository...

âœ” Found 5 difference(s)

All changed files:
  âœ“ prompt/0.overview.md (system memory - will be included in PR)
  âœ“ prompt/1.objectives.md (system memory - will be included in PR)
  âœ“ prompt/2.assumptions.md (system memory - will be included in PR)
  - memory/semantic/sem-001-api-design.md (skipped - not system memory)
  - memory/episodic/ep-005.md (skipped - not system memory)

Creating branch: sp-a1b2c3d4
âœ… Branch 'sp-a1b2c3d4' created with 3 system memory file(s)

ğŸ“ Files included in this PR:
   - prompt/0.overview.md
   - prompt/1.objectives.md
   - prompt/2.assumptions.md

ğŸ·ï¸  PR label: system-prompt-update

ğŸš€ Next steps:
   cd /tmp/claude-memory-a1b2c3d4
   git push origin sp-a1b2c3d4

   # Create PR with label:
   gh pr create --title "System memory: overview-objectives-assumptions" \
     --body "See commit message for details" \
     --label "system-prompt-update"

   # Or create PR without label:
   gh pr create --title "System memory: overview-objectives-assumptions" --body "See commit message for details"
```

## æŠ€æœ¯å®ç°

### æ–°å¢å‡½æ•°

**`git-ops.ts`:**
- `getTmpMemoryDir()` - ç”Ÿæˆå”¯ä¸€ tmp ç›®å½•è·¯å¾„
- `cloneMemoryRepoToTmp(repoUrl)` - å…‹éš†åˆ° tmp
- `diffMemoryRepos(srcDir, tgtDir)` - é€’å½’æ¯”è¾ƒç›®å½•
- `cleanupTmpDir(tmpDir)` - åˆ é™¤ tmp ç›®å½•
- `syncMemoryRepo(repoUrl, localDir, createPR)` - é«˜çº§åŒæ­¥å‡½æ•°
- `createPRForMemoryUpdates(tmpRepo, localDir, diffs)` - åˆ›å»ºåˆ†æ”¯å’Œæäº¤
- `extractCleanFilenames(files)` - æå–æ¸…æ´æ–‡ä»¶åï¼ˆå»é™¤åºå·å’Œæ‰©å±•åï¼‰
- `generateShortHash(content)` - ç”Ÿæˆ8ä½ MD5 hash
- `filterSystemMemoryFiles(files)` - è¿‡æ»¤ç³»ç»Ÿè®°å¿†æ–‡ä»¶
- `getGitUserInfo(repoDir)` - è·å– git ç”¨æˆ·ä¿¡æ¯
- `getPRLabel()` - è¿”å›ç»Ÿä¸€çš„ PR æ ‡ç­¾

**`initializer.ts`:**
- ä¿®æ”¹ `initialize()` - æ¥å—å¯é€‰çš„ `memoryRepoUrl` å‚æ•°
- ä¿®æ”¹ `copyMemorySystemTemplate()` - æ”¯æŒä» tmp æˆ–æœ¬åœ°å¤åˆ¶

**`cli.ts`:**
- `init` å‘½ä»¤æ·»åŠ  `--repo <url>` é€‰é¡¹
- æ–°å¢ `sync` å‘½ä»¤ï¼Œæ”¯æŒ `--pr` å’Œ `--no-cleanup` é€‰é¡¹

### ç›®å½•ç»“æ„

```
é¡¹ç›®ç›®å½•/
â”œâ”€â”€ claude/                    # æœ¬åœ°è®°å¿†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ prompt/               # ç³»ç»Ÿæç¤ºè¯ï¼ˆä¼šåŒ…å«åœ¨ PR ä¸­ï¼‰
â”‚   â”‚   â”œâ”€â”€ 0.overview.md
â”‚   â”‚   â”œâ”€â”€ 1.objectives.md
â”‚   â”‚   â””â”€â”€ 2.assumptions.md
â”‚   â”œâ”€â”€ memory/
â”‚   â”‚   â”œâ”€â”€ semantic/         # è¯­ä¹‰è®°å¿†ï¼ˆä¸åŒ…å«åœ¨ PR ä¸­ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ sem-001-api-design.md
â”‚   â”‚   â””â”€â”€ episodic/         # å¯¹è¯å†å²ï¼ˆä¸åŒ…å«åœ¨ PR ä¸­ï¼‰
â”‚   â””â”€â”€ config.yaml

ä¸´æ—¶ç›®å½•ï¼ˆè‡ªåŠ¨ç®¡ç†ï¼‰ï¼š
/tmp/claude-memory-a1b2c3d4/   # éšæœºç”Ÿæˆçš„ tmp ç›®å½•
â”œâ”€â”€ .git/
â”œâ”€â”€ prompt/                    # ä»è¿œç¨‹å…‹éš†çš„ç³»ç»Ÿæç¤ºè¯
â””â”€â”€ memory/
```

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šå›¢é˜Ÿå…±äº«æ¨¡æ¿åº“

```bash
# åˆå§‹åŒ–æ–°é¡¹ç›®
cd ~/projects/new-api
claude-memory-init init --quick --repo https://github.com/acme/memory-templates.git

# å·¥ä½œä¸­ï¼ŒClaude åˆ›å»ºè¯­ä¹‰è®°å¿†
# ä¾‹å¦‚ï¼šclaude/memory/semantic/sem-001-auth-flow.md

# ä½ ä¹Ÿæ›´æ–°äº†ç³»ç»Ÿæç¤ºè¯
# ä¾‹å¦‚ï¼šclaude/prompt/3.domain-terms.md

# è´¡çŒ®æ”¹è¿›å›å›¢é˜Ÿ
claude-memory-init sync --repo https://github.com/acme/memory-templates.git --pr

# ç»“æœï¼š
# - åªæœ‰ prompt/3.domain-terms.md è¢«æäº¤åˆ° PR
# - sem-001-auth-flow.md ä¿ç•™åœ¨æœ¬åœ°ï¼ˆé¡¹ç›®ç‰¹å®šçŸ¥è¯†ï¼‰
```

### åœºæ™¯ 2ï¼šä¸ªäººæ¨¡æ¿ç®¡ç†

```bash
# ä½¿ç”¨è‡ªå·±çš„æ¨¡æ¿
claude-memory-init init --quick --repo https://github.com/myname/claude-memories.git

# å·¥ä½œåæ›´æ–°æ¨¡æ¿
claude-memory-init sync --repo https://github.com/myname/claude-memories.git --pr

# æ¨é€
cd /tmp/claude-memory-xxxxx
git push origin myname-20250107-objectives
gh pr create
```

### åœºæ™¯ 3ï¼šæ£€æŸ¥å›¢é˜Ÿæ›´æ–°

```bash
# å®šæœŸæ£€æŸ¥å›¢é˜Ÿæ˜¯å¦æœ‰æ–°çš„ç³»ç»Ÿæç¤ºè¯
claude-memory-init sync --repo https://github.com/acme/memory-templates.git

# å¦‚æœå‘ç°è¿œç¨‹æœ‰æ–°å†…å®¹ï¼Œå¯ä»¥ï¼š
# 1. æ‰‹åŠ¨ä» tmp ç›®å½•å¤åˆ¶éœ€è¦çš„æ–‡ä»¶
# 2. æˆ–è€…è°¨æ…ä½¿ç”¨ --force é‡æ–°åˆå§‹åŒ–
```

## é…ç½®è¦æ±‚

**å¿…éœ€ï¼š**
- Git å·²å®‰è£…å¹¶é…ç½®
- `git config user.name` å’Œ `git config user.email` å·²è®¾ç½®

**æ¨èï¼š**
- GitHub CLI (`gh`) ç”¨äºå¿«é€Ÿåˆ›å»º PR
- SSH keys é…ç½®å¥½ç”¨äº push

## å®‰å…¨æ€§

1. **ä½¿ç”¨ç”¨æˆ· Git å‡­è¯** - ä¸å­˜å‚¨æˆ–ç®¡ç†å‡­è¯
2. **ä¸´æ—¶ç›®å½•éš”ç¦»** - éšæœºåç§°é¿å…å†²çª
3. **ä¸åŒ…å«æœºå¯†** - åªå¤„ç†æ–‡æ¡£å’Œæç¤ºè¯
4. **åªè¯»å…‹éš†** - ä½¿ç”¨ `--depth 1` å‡å°‘ä¸‹è½½

## è°ƒè¯•é€‰é¡¹

```bash
# ä¿ç•™ tmp ç›®å½•ç”¨äºæ£€æŸ¥
claude-memory-init sync --repo URL --pr --no-cleanup

# å·¥å…·ä¼šæ˜¾ç¤º tmp ç›®å½•ä½ç½®
# ä½ å¯ä»¥æ‰‹åŠ¨æ£€æŸ¥æˆ–æ¨é€
```

## æœªæ¥å¢å¼º

å¯èƒ½çš„æ”¹è¿›ï¼š
1. åŒå‘åŒæ­¥ - ä»è¿œç¨‹æ‹‰å–æ›´æ–°åˆ°æœ¬åœ°
2. è‡ªåŠ¨ PR åˆ›å»º - ä½¿ç”¨ GitHub API
3. å†²çªè§£å†³ - å¤„ç†æœ¬åœ°å’Œè¿œç¨‹éƒ½ä¿®æ”¹çš„æƒ…å†µ
4. åˆ†æ”¯é€‰æ‹© - æŒ‡å®šåŒæ­¥å“ªä¸ªåˆ†æ”¯
5. éƒ¨åˆ†åŒæ­¥ - åªåŒæ­¥ç‰¹å®šç›®å½•

## æ€»ç»“

æœ¬æ¬¡æ›´æ–°å®ç°äº†ï¼š
- âœ… ç”¨æˆ·ä¸å¯è§çš„ tmp ç›®å½•ç®¡ç†
- âœ… è¿œç¨‹ä»“åº“æ”¯æŒ
- âœ… æ™ºèƒ½è¿‡æ»¤ï¼ˆåªæäº¤ç³»ç»Ÿæç¤ºè¯ï¼‰
- âœ… æ™ºèƒ½åˆ†æ”¯å‘½åï¼ˆç”¨æˆ·å-æ—¥æœŸ-ä¸»é¢˜ï¼‰
- âœ… ä½¿ç”¨ç”¨æˆ· git é…ç½®
- âœ… ä»æ–‡ä»¶åæå–ä¸»é¢˜è¯
- âœ… è‡ªåŠ¨ PR æ ‡ç­¾å»ºè®®
- âœ… è¯¦ç»†çš„ç”¨æˆ·åé¦ˆ
- âœ… å®Œæ•´çš„æ–‡æ¡£

è¿™ä½¿å¾—å›¢é˜Ÿå¯ä»¥ï¼š
1. å…±äº«å’Œæ”¹è¿›ç³»ç»Ÿæç¤ºè¯æ¨¡æ¿
2. ä¿æŒé¡¹ç›®ç‰¹å®šçŸ¥è¯†æœ¬åœ°åŒ–
3. é€šè¿‡ PR å®¡æŸ¥ç¡®ä¿è´¨é‡
4. ä½¿ç”¨æ ‡ç­¾å¿«é€Ÿè¯†åˆ« PR å†…å®¹
5. è‡ªåŠ¨åŒ– merge æµç¨‹ï¼ˆåœ¨ CI/CD ä¸­ï¼‰
