# Subagent ä»»åŠ¡ç¼–æ’æŒ‡å—

æœ¬æ–‡æ¡£å®šä¹‰å¦‚ä½•ä½¿ç”¨ subagent å®Œæˆ v2.0 é‡æ„ä»»åŠ¡ã€‚

---

## æ€»ä½“ç­–ç•¥

### åˆ†æ²»ç­–ç•¥

å°†å¤§å‹é‡æ„æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å°ä»»åŠ¡ï¼Œæ¯ä¸ª subagent è´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„ä»»åŠ¡ã€‚

### å¹¶è¡Œæ‰§è¡Œ

å°½å¯èƒ½å¹¶è¡Œè¿è¡Œå¤šä¸ª subagentï¼ŒåŠ å¿«å¼€å‘é€Ÿåº¦ã€‚

### è´¨é‡ä¿è¯

æ¯ä¸ªä»»åŠ¡å®Œæˆåå®¡æŸ¥ï¼Œç¡®ä¿è´¨é‡åå†è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚

---

## ä»»åŠ¡ç¼–æ’

### Week 1: æ ¸å¿ƒæ¡†æ¶

#### Day 1-2: å¹¶è¡Œå¯åŠ¨

**Subagent 1**: Phase 1 - æ’ä»¶ç³»ç»Ÿæ ¸å¿ƒ
- ä»»åŠ¡: å®ç°æ’ä»¶ç³»ç»Ÿï¼ˆtypes, registry, loader, contextï¼‰
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Phase 1 Subagent Prompt
- é¢„è®¡: 2-3 å¤©

**Subagent 2**: Phase 2 - UI ç»„ä»¶åº“
- ä»»åŠ¡: å®ç°äº¤äº’å¼ UI ç»„ä»¶ï¼ˆ5 ä¸ªç»„ä»¶ï¼‰
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Phase 2 Subagent Prompt
- é¢„è®¡: 1-2 å¤©

**Subagent 3**: Extra 1 - æ’ä»¶ Prompt è§„èŒƒï¼ˆç‹¬ç«‹ä»»åŠ¡ï¼‰
- ä»»åŠ¡: è®¾è®¡æ’ä»¶å¦‚ä½•è´¡çŒ® CLAUDE.md å†…å®¹
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Extra 1 Subagent Prompt
- é¢„è®¡: 1 å¤©

**Subagent 4**: Extra 2 - mem ç›®å½•æ”¹é€ ï¼ˆç‹¬ç«‹ä»»åŠ¡ï¼‰
- ä»»åŠ¡: è®¾è®¡ mem ä»“åº“çš„æ–°ç»“æ„
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Extra 2 Subagent Prompt
- é¢„è®¡: 1 å¤©

**å¹¶è¡ŒåŸå› **: è¿™ 4 ä¸ªä»»åŠ¡äº’ç›¸ç‹¬ç«‹ï¼Œæ— ä¾èµ–å…³ç³»ã€‚

#### Day 3-4: äº¤äº’å¼åˆå§‹åŒ–å™¨

**ä¾èµ–**: Subagent 1 å’Œ 2 å®Œæˆ

**Subagent 5**: Phase 3 - äº¤äº’å¼åˆå§‹åŒ–å™¨
- ä»»åŠ¡: å®ç°ä¸»åˆå§‹åŒ–æµç¨‹ï¼ˆåŠ¨æ€æ­¥éª¤ï¼‰
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Phase 3 Subagent Prompt
- é¢„è®¡: 2-3 å¤©

### Week 2-3: æ’ä»¶å®ç°

#### Day 5-9: å¹¶è¡Œå®ç° 4 ä¸ªæ’ä»¶

**ä¾èµ–**: Phase 1-3 å®Œæˆ

**Subagent 6**: Phase 4.1 - System Detector æ’ä»¶
- ä»»åŠ¡: ç³»ç»Ÿæ£€æµ‹æ’ä»¶
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Phase 4.1 Subagent Prompt
- é¢„è®¡: 1 å¤©

**Subagent 7**: Phase 4.2 - Prompt Presets æ’ä»¶
- ä»»åŠ¡: é¢„è®¾æç¤ºè¯æ’ä»¶
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Phase 4.2 Subagent Prompt
- é¢„è®¡: 2 å¤©

**Subagent 8**: Phase 4.3 - Memory System æ’ä»¶
- ä»»åŠ¡: è®°å¿†ç³»ç»Ÿæ’ä»¶ + memory system-add å‘½ä»¤
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Phase 4.3 Subagent Prompt
- é¢„è®¡: 2 å¤©

**Subagent 9**: Phase 4.4 - Git æ’ä»¶
- ä»»åŠ¡: Git é›†æˆæ’ä»¶
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Phase 4.4 Subagent Prompt
- é¢„è®¡: 2 å¤©

**å¹¶è¡ŒåŸå› **: æ’ä»¶ä¹‹é—´æ— ä¾èµ–ï¼Œå¯åŒæ—¶å¼€å‘ã€‚

#### Day 10-11: CLI å’Œé…ç½®è¿ç§»

**ä¾èµ–**: æ‰€æœ‰æ’ä»¶å®Œæˆ

**Subagent 10**: Phase 5 - CLI é‡æ„
- ä»»åŠ¡: ç®€åŒ– CLIï¼Œå®ç°æ’ä»¶å‘½ä»¤æ³¨å†Œ
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Phase 5 Subagent Prompt
- é¢„è®¡: 1 å¤©

**Subagent 11**: Phase 6 - é…ç½®è¿ç§»
- ä»»åŠ¡: v1.x åˆ° v2.0 é…ç½®è¿ç§»
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Phase 6 Subagent Prompt
- é¢„è®¡: 1-2 å¤©

### Week 4: å›½é™…åŒ–

#### Day 12-17: i18n å®ç°

**Subagent 12**: Phase 7 - å›½é™…åŒ–
- ä»»åŠ¡: å®Œæ•´çš„ i18n æ”¯æŒï¼ˆè‹±è¯­ + ä¸­æ–‡ï¼‰
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Phase 7 Subagent Prompt
- é¢„è®¡: 6-7 å¤©
- è¯´æ˜: è¿™æ˜¯æœ€è€—æ—¶çš„ä»»åŠ¡ï¼ˆéœ€è¦ç¿»è¯‘æ‰€æœ‰æ–‡æœ¬ï¼‰

### Week 5: æµ‹è¯•å’Œæ–‡æ¡£

#### Day 18-20: æµ‹è¯•

**Subagent 13**: Phase 8 - æµ‹è¯•
- ä»»åŠ¡: å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• + E2E æµ‹è¯•
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Phase 8 Subagent Prompt
- é¢„è®¡: 2-3 å¤©

#### Day 21: æ–‡æ¡£

**Subagent 14**: Phase 9 - æ–‡æ¡£æ›´æ–°
- ä»»åŠ¡: ç”¨æˆ·æ–‡æ¡£ã€å¼€å‘è€…æ–‡æ¡£
- Prompt: è§ `IMPLEMENTATION_TASKS.md` Phase 9 Subagent Prompt
- é¢„è®¡: 1 å¤©

---

## Subagent é€šç”¨æŒ‡ä»¤

### æ¯ä¸ª Subagent å¿…é¡»éµå®ˆ

```markdown
## é€šç”¨è¦æ±‚

### 1. é˜…è¯»ææ–™ï¼ˆå¿…éœ€ï¼Œä¸è¦è·³è¿‡ï¼‰

**ğŸ”¥ é‡è¦ï¼šæˆ‘ä»¬ä½¿ç”¨ 1M context çª—å£ï¼Œå……åˆ†åˆ©ç”¨ä¸Šä¸‹æ–‡ï¼**

åœ¨å¼€å§‹ç¼–ç å‰ï¼Œä½ å¿…é¡»ï¼š
- âœ… **å®Œæ•´é˜…è¯»æ‰€æœ‰ç›¸å…³è®¾è®¡æ–‡æ¡£**ï¼ˆä¸è¦åªè¯»ä¸€éƒ¨åˆ†ï¼‰
  - ä½ çš„ä»»åŠ¡å¯¹åº”çš„è®¾è®¡æ–‡æ¡£
  - REFACTOR_SUMMARY.mdï¼ˆç†è§£æ•´ä½“æ¶æ„ï¼‰
  - PLUGIN_ARCHITECTURE_REFACTOR.mdï¼ˆç†è§£æ’ä»¶ç³»ç»Ÿï¼‰
  - å…¶ä»–ç›¸å…³æ–‡æ¡£
- âœ… **å®Œæ•´é˜…è¯»ç°æœ‰ä»£ç **ï¼ˆä¸è¦ä¸ºäº†çœ token åªè¯»ä¸€éƒ¨åˆ†ï¼‰
  - å¦‚æœæœ‰è¿ç§»ä»»åŠ¡ï¼Œå®Œæ•´é˜…è¯»éœ€è¦è¿ç§»çš„æ–‡ä»¶
  - é˜…è¯»ç›¸å…³çš„å·¥å…·å‡½æ•°ï¼ˆlogger, file-ops ç­‰ï¼‰
- âœ… **æ£€ç´¢ç½‘ç»œæ–‡æ¡£**ï¼ˆä¼˜å…ˆæŸ¥è¯¢æœ€æ–°çš„åº“æ–‡æ¡£ï¼‰
  - inquirer.js å®˜æ–¹æ–‡æ¡£
  - i18next å®˜æ–¹æ–‡æ¡£
  - Commander.js å®˜æ–¹æ–‡æ¡£
  - TypeScript æœ€ä½³å®è·µ
  - å…¶ä»–ä½¿ç”¨çš„åº“
- âœ… ç†è§£ä»»åŠ¡ç›®æ ‡å’ŒéªŒæ”¶æ ‡å‡†
- âœ… ç†è§£ä¾èµ–å…³ç³»

**ä¸ºä»€ä¹ˆè¦å®Œæ•´é˜…è¯»ï¼Ÿ**
- æˆ‘ä»¬æœ‰ 1M context çª—å£ï¼Œä¸éœ€è¦çœ token
- å®Œæ•´çš„ä¸Šä¸‹æ–‡èƒ½é¿å…é—æ¼é‡è¦ç»†èŠ‚
- å‡å°‘æ¥å›ç¡®è®¤ï¼Œæé«˜æ•ˆç‡

### 2. æŠ€æœ¯æ ˆå’Œè§„èŒƒ

**é¡¹ç›®é…ç½®**:
- âœ… **åŒ…ç®¡ç†å™¨**: pnpmï¼ˆä¸æ˜¯ npm æˆ– yarnï¼‰
- âœ… **è¯­è¨€**: TypeScriptï¼ˆå¿…é¡»ï¼Œä¸è¦ç”¨ JavaScriptï¼‰
- âœ… **æ¨¡å—ç³»ç»Ÿ**: ESM (type: "module")
- âœ… **Node ç‰ˆæœ¬**: >= 18.0.0

**ç¼–ç é£æ ¼**:
- âœ… **å‡½æ•°å¼ä¼˜å…ˆ**ï¼ˆå°½å¯èƒ½ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹ï¼‰
  - ä¼˜å…ˆä½¿ç”¨çº¯å‡½æ•°
  - é¿å…å¯å˜çŠ¶æ€
  - ä½¿ç”¨ constï¼Œé¿å… let
  - ä¼˜å…ˆä½¿ç”¨ map/filter/reduce
- âœ… **ç±»å‹å®Œå¤‡**ï¼ˆTypeScript ä¸¥æ ¼æ¨¡å¼ï¼‰
  - æ‰€æœ‰å‡½æ•°éƒ½è¦æœ‰å®Œæ•´çš„ç±»å‹ç­¾å
  - é¿å…ä½¿ç”¨ anyï¼ˆé™¤éå¿…è¦ï¼‰
  - ä½¿ç”¨æ³›å‹æé«˜å¤ç”¨æ€§
  - å¯¼å‡ºæ‰€æœ‰å…¬å¼€çš„ç±»å‹
- âœ… **å‘½åæ¸…æ™°**
  - å‡½æ•°å: åŠ¨è¯å¼€å¤´ï¼ˆcreateContext, loadPluginï¼‰
  - ç±»å‹å: åè¯ï¼ˆPlugin, PluginContextï¼‰
  - å¸ƒå°”å€¼: is/has å¼€å¤´ï¼ˆisEnabled, hasCommandsï¼‰

**ç¤ºä¾‹ï¼ˆæ¨èçš„é£æ ¼ï¼‰**:

```typescript
// âœ… æ¨èï¼šå‡½æ•°å¼ + ç±»å‹å®Œå¤‡
export const createPluginContext = async (
  projectRoot: string,
  config: CoreConfig
): Promise<PluginContext> => {
  const logger = createLogger();
  const fs = createFileOperations();
  const template = createTemplateEngine();

  return {
    projectRoot,
    targetDir: projectRoot,
    config: {
      core: config,
      plugins: new Map()
    },
    shared: new Map(),
    logger,
    fs,
    template,
    ui: {} as UIComponents,
    i18n: {} as I18nAPI
  };
};

// âŒ é¿å…ï¼šé¢å‘å¯¹è±¡ + ç±»å‹ä¸å®Œæ•´
class ContextBuilder {
  private root: string;

  setRoot(root: any) {  // any ç±»å‹
    this.root = root;
    return this;
  }

  build() {  // ç¼ºå°‘è¿”å›ç±»å‹
    return { ... };
  }
}
```

### 3. ç¼–ç è§„èŒƒ
- âœ… ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼ï¼ˆtsconfig strict: trueï¼‰
- âœ… éµå¾ªé¡¹ç›®ç°æœ‰çš„ä»£ç é£æ ¼
- âœ… æ·»åŠ å®Œæ•´çš„ JSDoc æ³¨é‡Šï¼ˆä¸­æ–‡æˆ–è‹±æ–‡ï¼‰
- âœ… å¤„ç†é”™è¯¯å’Œè¾¹ç•Œæƒ…å†µï¼ˆä½¿ç”¨ç±»å‹ç³»ç»Ÿï¼‰
- âœ… ä½¿ç”¨ç°æœ‰çš„å·¥å…·å‡½æ•°ï¼ˆlogger, file-ops ç­‰ï¼‰
- âœ… å¯¼å‡ºæ‰€æœ‰å…¬å¼€çš„ç±»å‹å’Œæ¥å£

### 4. ä¾èµ–å’Œåº“ä½¿ç”¨

**å·²æœ‰ä¾èµ–**ï¼ˆç›´æ¥ä½¿ç”¨ï¼‰:
- Commander.js v12 - CLI æ¡†æ¶
- Inquirer.js v9 - äº¤äº’å¼è¾“å…¥
- Ora v8 - è¿›åº¦æ˜¾ç¤º
- Chalk v5 - å½©è‰²è¾“å‡º
- Simple-git v3 - Git æ“ä½œ
- YAML v2 - é…ç½®æ–‡ä»¶
- fs-extra v11 - æ–‡ä»¶æ“ä½œ

**éœ€è¦æ·»åŠ **ï¼ˆPhase 7ï¼‰:
- i18next v23 - å›½é™…åŒ–
- i18next-fs-backend v2 - æ–‡ä»¶åç«¯

**ä½¿ç”¨å‰å¿…é¡»**:
- âœ… æ£€ç´¢å®˜æ–¹æ–‡æ¡£ï¼ˆä½¿ç”¨æœ€æ–°çš„ APIï¼‰
- âœ… æŸ¥çœ‹ TypeScript ç±»å‹å®šä¹‰
- âœ… äº†è§£æœ€ä½³å®è·µ

### 5. æµ‹è¯•è¦æ±‚
- âœ… ä¸ºæ¯ä¸ªåŠŸèƒ½ç¼–å†™å•å…ƒæµ‹è¯•
- âœ… ä½¿ç”¨ Jest æµ‹è¯•æ¡†æ¶
- âœ… è¦†ç›–ç‡ > 80%
- âœ… æµ‹è¯•è¾¹ç•Œæƒ…å†µ
- âœ… Mock å¤–éƒ¨ä¾èµ–ï¼ˆGit, GitHub, æ–‡ä»¶ç³»ç»Ÿç­‰ï¼‰
- âœ… æµ‹è¯•æ–‡ä»¶å‘½å: `*.test.ts`
- âœ… æµ‹è¯•å¿…é¡»é€šè¿‡

**æµ‹è¯•ç¤ºä¾‹**:

```typescript
// tests/plugin/registry.test.ts
import { describe, it, expect } from '@jest/globals';
import { PluginRegistry } from '../../src/plugin/registry';
import type { Plugin } from '../../src/plugin/types';

describe('PluginRegistry', () => {
  const mockPlugin: Plugin = {
    meta: {
      name: 'test-plugin',
      commandName: 'test',
      version: '1.0.0',
      description: 'Test plugin'
    },
    commands: []
  };

  it('should register a plugin', () => {
    const registry = new PluginRegistry();
    registry.register(mockPlugin);

    expect(registry.has('test-plugin')).toBe(true);
    expect(registry.get('test-plugin')).toEqual(mockPlugin);
  });

  it('should throw error on duplicate registration', () => {
    const registry = new PluginRegistry();
    registry.register(mockPlugin);

    expect(() => registry.register(mockPlugin)).toThrow();
  });
});
```

### 6. æ±‡æŠ¥è¦æ±‚
å®Œæˆåä½¿ç”¨æ ‡å‡†æ¨¡æ¿æ±‡æŠ¥ï¼ˆè§ IMPLEMENTATION_TASKS.mdï¼‰ï¼š
- âœ… ä»»åŠ¡æ‘˜è¦
- âœ… å®ç°çš„æ–‡ä»¶åˆ—è¡¨
- âœ… å…³é”®è®¾è®¡å†³ç­–
- âœ… æµ‹è¯•ç»“æœï¼ˆè¦†ç›–ç‡ã€é€šè¿‡ç‡ï¼‰
- âœ… é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- âœ… ä¸‹ä¸€æ­¥å»ºè®®
- âœ… å…³é”®ä»£ç ç¤ºä¾‹

### 7. åä½œè§„èŒƒ
- âœ… ä¸è¦ä¿®æ”¹å…¶ä»– subagent è´Ÿè´£çš„æ–‡ä»¶
- âœ… å¦‚æœéœ€è¦ä¿®æ”¹å…±äº«æ–‡ä»¶ï¼Œå…ˆæ±‡æŠ¥è®¨è®º
- âœ… ä½¿ç”¨ Git åˆ†æ”¯ï¼ˆfeature/phase-X-Yï¼‰
- âœ… æäº¤ä¿¡æ¯æ¸…æ™°ï¼ˆfeat/fix/refactor/testï¼‰
- âœ… ä½¿ç”¨ pnpmï¼ˆä¸æ˜¯ npm/yarnï¼‰

### 8. é—®é¢˜å¤„ç†
é‡åˆ°ä»¥ä¸‹æƒ…å†µå¿…é¡»ç«‹å³æ±‡æŠ¥ï¼š
- âš ï¸ è®¾è®¡æ–‡æ¡£æœ‰æ­§ä¹‰æˆ–çŸ›ç›¾
- âš ï¸ å‘ç°è®¾è®¡ç¼ºé™·
- âš ï¸ æŠ€æœ¯éš¾ç‚¹æ— æ³•è§£å†³
- âš ï¸ ä¾èµ–çš„åŠŸèƒ½ä¸å­˜åœ¨æˆ–ä¸å®Œæ•´
- âš ï¸ æ—¶é—´é¢„è®¡ä¸¥é‡åå·®
- âš ï¸ åº“çš„æ–‡æ¡£ä¸é¢„æœŸä¸ç¬¦

### 9. Context çª—å£åˆ©ç”¨

**ğŸ”¥ æˆ‘ä»¬æœ‰ 1M context çª—å£ï¼Œå……åˆ†åˆ©ç”¨ï¼**

- âœ… **å®Œæ•´é˜…è¯»æ–‡ä»¶**ï¼Œä¸è¦åªè¯»å‰ 100 è¡Œ
- âœ… **é˜…è¯»æ‰€æœ‰è®¾è®¡æ–‡æ¡£**ï¼Œä¸è¦åªè¯»æ‘˜è¦
- âœ… **æ£€ç´¢å®Œæ•´çš„åº“æ–‡æ¡£**ï¼Œä¸è¦åªçœ‹ç¤ºä¾‹
- âœ… **ç†è§£å®Œæ•´çš„ä¸Šä¸‹æ–‡**ï¼Œä¸è¦ç¢ç‰‡åŒ–ç†è§£

**ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ**
- é¿å…é—æ¼å…³é”®ä¿¡æ¯
- å‡å°‘æ¥å›ç¡®è®¤æ¬¡æ•°
- æé«˜ä»£ç è´¨é‡
- åŠ å¿«å¼€å‘é€Ÿåº¦
```

---

## å¯åŠ¨ç¤ºä¾‹

### å¯åŠ¨ç¬¬ä¸€æ‰¹ Subagentï¼ˆDay 1ï¼‰

```markdown
æˆ‘éœ€è¦å¯åŠ¨ 4 ä¸ªå¹¶è¡Œçš„ subagent å®Œæˆ v2.0 é‡æ„çš„åŸºç¡€å·¥ä½œã€‚

## Subagent 1: æ’ä»¶ç³»ç»Ÿæ ¸å¿ƒ

**ä»»åŠ¡**: å®ç°æ’ä»¶ç³»ç»Ÿæ ¸å¿ƒæ¡†æ¶ï¼ˆPhase 1ï¼‰

**ä½ çš„ä»»åŠ¡æ˜¯å®ç° claude-init v2.0 çš„æ’ä»¶ç³»ç»Ÿæ ¸å¿ƒæ¡†æ¶ã€‚**

**èƒŒæ™¯**:
- é¡¹ç›®æ˜¯ä¸€ä¸ª CLI å·¥å…·ï¼Œä½¿ç”¨ TypeScript ç¼–å†™
- æˆ‘ä»¬æ­£åœ¨å°†å•ä½“æ¶æ„é‡æ„ä¸ºæ’ä»¶åŒ–æ¶æ„
- ç›®æ ‡æ˜¯è®©æ¯ä¸ªåŠŸèƒ½éƒ½ä½œä¸ºæ’ä»¶å®ç°

**è®¾è®¡æ–‡æ¡£**:

ğŸ”¥ **è¯·å®Œæ•´é˜…è¯»ä»¥ä¸‹æ‰€æœ‰è®¾è®¡æ–‡æ¡£ï¼ˆä¸è¦è·³è¿‡ï¼Œåˆ©ç”¨ 1M contextï¼‰**:

1. `docs/README.md` - æ–‡æ¡£ç´¢å¼•ï¼Œäº†è§£æ•´ä½“ç»“æ„
2. `docs/REFACTOR_SUMMARY.md` - é‡æ„æ€»è§ˆï¼Œç†è§£å¤§å±€
3. `docs/PLUGIN_ARCHITECTURE_REFACTOR.md` - **é‡ç‚¹**ï¼Œæ’ä»¶ç³»ç»Ÿè¯¦ç»†è®¾è®¡
4. `docs/INTERACTIVE_CLI_DESIGN.md` - äº¤äº’å¼æµç¨‹è®¾è®¡
5. `docs/CLI_COMMANDS_DESIGN.md` - å‘½ä»¤ç»“æ„è®¾è®¡
6. `docs/IMPLEMENTATION_TASKS.md` - æŸ¥çœ‹ Phase 1 çš„è¯¦ç»†ä»»åŠ¡æ¸…å•

**ä¸ºä»€ä¹ˆè¦è¯»è¿™ä¹ˆå¤šï¼Ÿ**
- ç†è§£æ•´ä½“æ¶æ„ï¼Œé¿å…è®¾è®¡ä¸ä¸€è‡´
- äº†è§£æ’ä»¶å¦‚ä½•ä¸ CLI é›†æˆ
- ç†è§£ä¸Šä¸‹æ–‡å’Œä¾èµ–å…³ç³»
- æˆ‘ä»¬æœ‰ 1M contextï¼Œå……åˆ†åˆ©ç”¨ï¼

**å¿…è¯»ç« èŠ‚**:
- `PLUGIN_ARCHITECTURE_REFACTOR.md` çš„"æ’ä»¶ç³»ç»Ÿæ¥å£"ç« èŠ‚ï¼ˆæ ¸å¿ƒï¼‰
- `PLUGIN_ARCHITECTURE_REFACTOR.md` çš„æ‰€æœ‰æ’ä»¶ç¤ºä¾‹ï¼ˆç†è§£å¦‚ä½•ä½¿ç”¨ï¼‰

**åº“æ–‡æ¡£æ£€ç´¢**:

åœ¨å¼€å§‹ç¼–ç å‰ï¼Œè¯·å…ˆæ£€ç´¢ä»¥ä¸‹åº“çš„å®˜æ–¹æ–‡æ¡£ï¼š

1. **TypeScript** - æœ€æ–°çš„ç±»å‹ç³»ç»Ÿç‰¹æ€§å’Œæœ€ä½³å®è·µ
2. äº†è§£æœ¬é¡¹ç›®å·²æœ‰çš„å·¥å…·ï¼š
   - é˜…è¯» `src/utils/logger.ts` - æ—¥å¿—å·¥å…·
   - é˜…è¯» `src/utils/file-ops.ts` - æ–‡ä»¶æ“ä½œ
   - é˜…è¯» `src/core/template-engine.ts` - æ¨¡æ¿å¼•æ“

**ä½ éœ€è¦å®Œæˆ**:
1. å®šä¹‰æ’ä»¶ç±»å‹ç³»ç»Ÿ (`src/plugin/types.ts`)
   - Plugin æ¥å£
   - PluginContext æ¥å£
   - PluginHooks æ¥å£
   - PluginCommand æ¥å£
   - PluginConfigurationFlow æ¥å£
   - CommandOption æ¥å£

2. å®ç°æ’ä»¶æ³¨å†Œè¡¨ (`src/plugin/registry.ts`)
   - register(plugin) - æ³¨å†Œæ’ä»¶
   - get(name) - è·å–æ’ä»¶
   - getAll() - è·å–æ‰€æœ‰æ’ä»¶
   - has(name) - æ£€æŸ¥æ˜¯å¦å­˜åœ¨
   - getEnabled(config) - è·å–å·²å¯ç”¨æ’ä»¶
   - æ’ä»¶éªŒè¯é€»è¾‘
   - å¤„ç†åç§°å†²çª

3. å®ç°æ’ä»¶åŠ è½½å™¨ (`src/plugin/loader.ts`)
   - load(config, context) - åŠ è½½æ’ä»¶
   - executeHook(hookName, context) - æ‰§è¡Œé’©å­
   - sortByDependencies(plugins) - æ‹“æ‰‘æ’åº
   - ä¾èµ–å¾ªç¯æ£€æµ‹
   - é”™è¯¯å¤„ç†

4. å®ç°æ’ä»¶ä¸Šä¸‹æ–‡ (`src/plugin/context.ts`)
   - createPluginContext() å‡½æ•°
   - æä¾› logger, fs, template ç­‰å·¥å…·
   - å…±äº«æ•°æ®éš”ç¦»

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰ TypeScript ç±»å‹å®šä¹‰æ­£ç¡®
- [ ] æ’ä»¶å¯ä»¥æˆåŠŸæ³¨å†Œå’ŒåŠ è½½
- [ ] ä¾èµ–æ’åºç®—æ³•æ­£ç¡®ï¼ˆæ‹“æ‰‘æ’åºï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] ä»£ç æœ‰æ¸…æ™°çš„ JSDoc æ³¨é‡Š

**é€šç”¨è¦æ±‚**:
[éµå®ˆä¸Šè¿°"Subagent é€šç”¨æŒ‡ä»¤"]

**å®Œæˆåå‘æˆ‘æ±‡æŠ¥**:
ä½¿ç”¨æ ‡å‡†æ±‡æŠ¥æ¨¡æ¿ï¼ˆè§ IMPLEMENTATION_TASKS.mdï¼‰

---

## Subagent 2: UI ç»„ä»¶åº“

[ç±»ä¼¼çš„è¯¦ç»† prompt...]

---

## Subagent 3: æ’ä»¶ Prompt è§„èŒƒ

[ç±»ä¼¼çš„è¯¦ç»† prompt...]

---

## Subagent 4: mem ç›®å½•æ”¹é€ 

[ç±»ä¼¼çš„è¯¦ç»† prompt...]
```

---

## å®¡æŸ¥æ£€æŸ¥æ¸…å•

### ä»£ç å®¡æŸ¥

æ¯ä¸ª subagent å®Œæˆåï¼Œä½ éœ€è¦æ£€æŸ¥ï¼š

- [ ] **åŠŸèƒ½å®Œæ•´æ€§**: æ‰€æœ‰è¦æ±‚çš„åŠŸèƒ½éƒ½å®ç°äº†å—ï¼Ÿ
- [ ] **ä»£ç è´¨é‡**: ä»£ç æ¸…æ™°ã€æœ‰æ³¨é‡Šã€ç¬¦åˆè§„èŒƒå—ï¼Ÿ
- [ ] **ç±»å‹å®‰å…¨**: TypeScript ç±»å‹å®šä¹‰æ­£ç¡®å—ï¼Ÿ
- [ ] **é”™è¯¯å¤„ç†**: è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯éƒ½å¤„ç†äº†å—ï¼Ÿ
- [ ] **æµ‹è¯•è¦†ç›–**: æµ‹è¯•å……åˆ†å—ï¼Ÿè¦†ç›–ç‡è¾¾æ ‡å—ï¼Ÿ
- [ ] **è®¾è®¡ä¸€è‡´**: ä¸è®¾è®¡æ–‡æ¡£ä¸€è‡´å—ï¼Ÿ
- [ ] **é›†æˆæ€§**: èƒ½ä¸å…¶ä»–éƒ¨åˆ†è‰¯å¥½é›†æˆå—ï¼Ÿ

### æµ‹è¯•å®¡æŸ¥

- [ ] **å•å…ƒæµ‹è¯•**: æ¯ä¸ªå‡½æ•°/ç±»éƒ½æœ‰æµ‹è¯•å—ï¼Ÿ
- [ ] **é›†æˆæµ‹è¯•**: ç»„ä»¶é—´çš„é›†æˆæµ‹è¯•äº†å—ï¼Ÿ
- [ ] **è¾¹ç•Œæƒ…å†µ**: ç©ºè¾“å…¥ã€é”™è¯¯è¾“å…¥ã€æç«¯æƒ…å†µéƒ½æµ‹è¯•äº†å—ï¼Ÿ
- [ ] **Mock æ­£ç¡®**: å¤–éƒ¨ä¾èµ– Mock å¾—å½“å—ï¼Ÿ
- [ ] **æµ‹è¯•é€šè¿‡**: æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†å—ï¼Ÿ

### æ–‡æ¡£å®¡æŸ¥

- [ ] **JSDoc**: æ‰€æœ‰å…¬å¼€æ¥å£éƒ½æœ‰æ–‡æ¡£å—ï¼Ÿ
- [ ] **ä½¿ç”¨ç¤ºä¾‹**: å¤æ‚åŠŸèƒ½æœ‰ç¤ºä¾‹å—ï¼Ÿ
- [ ] **è®¾è®¡è¯´æ˜**: å…³é”®è®¾è®¡å†³ç­–æœ‰è§£é‡Šå—ï¼Ÿ

---

## å†²çªè§£å†³

### æ–‡ä»¶å†²çª

å¦‚æœå¤šä¸ª subagent éœ€è¦ä¿®æ”¹åŒä¸€æ–‡ä»¶ï¼š
1. å…ˆå®ŒæˆåŸºç¡€è®¾æ–½ï¼ˆPhase 1-3ï¼‰
2. æ’ä»¶å®Œå…¨ç‹¬ç«‹ï¼Œä¸ä¼šå†²çª
3. å…±äº«æ–‡ä»¶ï¼ˆå¦‚ cli.tsï¼‰ç”±å•ç‹¬çš„ subagent è´Ÿè´£

### æ¥å£å˜æ›´

å¦‚æœ subagent å‘ç°æ¥å£éœ€è¦è°ƒæ•´ï¼š
1. ç«‹å³æ±‡æŠ¥
2. è®¨è®ºåç»Ÿä¸€ä¿®æ”¹
3. é€šçŸ¥ç›¸å…³çš„å…¶ä»– subagent

### è®¾è®¡é—®é¢˜

å¦‚æœè®¾è®¡æ–‡æ¡£æœ‰é—®é¢˜ï¼š
1. Subagent æ±‡æŠ¥é—®é¢˜
2. ä½ æ›´æ–°è®¾è®¡æ–‡æ¡£
3. Subagent æŒ‰æ–°è®¾è®¡ç»§ç»­

---

## è¿›åº¦è·Ÿè¸ª

### è¿›åº¦è¡¨

| Phase | ä»»åŠ¡ | Subagent | çŠ¶æ€ | é¢„è®¡ | å®é™… |
|-------|------|----------|------|------|------|
| 1 | æ’ä»¶ç³»ç»Ÿæ ¸å¿ƒ | SA-1 | ğŸ”µ å¾…å¼€å§‹ | 2-3å¤© | - |
| 2 | UI ç»„ä»¶åº“ | SA-2 | ğŸ”µ å¾…å¼€å§‹ | 1-2å¤© | - |
| 3 | äº¤äº’å¼åˆå§‹åŒ–å™¨ | SA-5 | ğŸ”µ å¾…å¼€å§‹ | 2-3å¤© | - |
| 4.1 | System Detector | SA-6 | ğŸ”µ å¾…å¼€å§‹ | 1å¤© | - |
| 4.2 | Prompt Presets | SA-7 | ğŸ”µ å¾…å¼€å§‹ | 2å¤© | - |
| 4.3 | Memory System | SA-8 | ğŸ”µ å¾…å¼€å§‹ | 2å¤© | - |
| 4.4 | Git æ’ä»¶ | SA-9 | ğŸ”µ å¾…å¼€å§‹ | 2å¤© | - |
| 5 | CLI é‡æ„ | SA-10 | ğŸ”µ å¾…å¼€å§‹ | 1å¤© | - |
| 6 | é…ç½®è¿ç§» | SA-11 | ğŸ”µ å¾…å¼€å§‹ | 1-2å¤© | - |
| 7 | å›½é™…åŒ– | SA-12 | ğŸ”µ å¾…å¼€å§‹ | 6-7å¤© | - |
| 8 | æµ‹è¯• | SA-13 | ğŸ”µ å¾…å¼€å§‹ | 2-3å¤© | - |
| 9 | æ–‡æ¡£æ›´æ–° | SA-14 | ğŸ”µ å¾…å¼€å§‹ | 1å¤© | - |
| E1 | Prompt è§„èŒƒ | SA-3 | ğŸ”µ å¾…å¼€å§‹ | 1å¤© | - |
| E2 | mem æ”¹é€  | SA-4 | ğŸ”µ å¾…å¼€å§‹ | 1å¤© | - |

**çŠ¶æ€è¯´æ˜**:
- ğŸ”µ å¾…å¼€å§‹
- ğŸŸ¡ è¿›è¡Œä¸­
- ğŸŸ¢ å·²å®Œæˆ
- ğŸ”´ é˜»å¡

---

## å¯åŠ¨è„šæœ¬æ¨¡æ¿

### Day 1: å¯åŠ¨åŸºç¡€å·¥ä½œ

```markdown
å¯åŠ¨ 4 ä¸ªå¹¶è¡Œ subagentï¼š

---

### Subagent 1: æ’ä»¶ç³»ç»Ÿæ ¸å¿ƒ

ä½ çš„ä»»åŠ¡æ˜¯å®ç° claude-init v2.0 çš„æ’ä»¶ç³»ç»Ÿæ ¸å¿ƒæ¡†æ¶ã€‚

**é¡¹ç›®èƒŒæ™¯**:
- ä»“åº“: /home/dai/code/claude-memory-init
- å½“å‰ç‰ˆæœ¬: v1.0.0
- ç›®æ ‡ç‰ˆæœ¬: v2.0.0-alpha
- æŠ€æœ¯æ ˆ: TypeScript + Node.js + Commander.js

**è®¾è®¡æ–‡æ¡£**:
è¯·å…ˆé˜…è¯»ä»¥ä¸‹æ–‡æ¡£ï¼ˆæŒ‰é¡ºåºï¼‰ï¼š
1. `docs/README.md` - äº†è§£æ•´ä½“é‡æ„æ–¹æ¡ˆ
2. `docs/PLUGIN_ARCHITECTURE_REFACTOR.md` - é‡ç‚¹é˜…è¯»"æ’ä»¶ç³»ç»Ÿæ¥å£"ç« èŠ‚
3. `docs/IMPLEMENTATION_TASKS.md` - æŸ¥çœ‹ Phase 1 çš„è¯¦ç»†è¦æ±‚

**ä½ çš„ä»»åŠ¡**:

#### Task 1.1: å®šä¹‰æ’ä»¶ç±»å‹ (src/plugin/types.ts)

åˆ›å»ºå®Œæ•´çš„æ’ä»¶ç±»å‹ç³»ç»Ÿï¼š

\```typescript
// å¿…éœ€çš„æ¥å£ï¼ˆæŒ‰è¿™ä¸ªé¡ºåºå®šä¹‰ï¼‰

1. PluginContext - æ’ä»¶è¿è¡Œæ—¶ä¸Šä¸‹æ–‡
   - projectRoot: string
   - targetDir: string
   - config: SharedConfig
   - shared: Map<string, any>
   - logger: Logger
   - fs: FileOperations
   - template: TemplateEngine
   - ui: UIComponents (é¢„ç•™ï¼ŒPhase 2 å®Œæˆåé›†æˆ)
   - i18n: I18nAPI (é¢„ç•™ï¼ŒPhase 7 å®Œæˆåé›†æˆ)

2. PluginHooks - ç”Ÿå‘½å‘¨æœŸé’©å­
   - beforeInit?: (context) => Promise<void>
   - configure?: (context) => Promise<PluginConfig>
   - execute?: (context) => Promise<void>
   - afterInit?: (context) => Promise<void>
   - cleanup?: (context) => Promise<void>

3. PluginCommand - æ’ä»¶å‘½ä»¤
   - name: string
   - description: string
   - options?: CommandOption[]
   - action: (options, context) => Promise<void>

4. PluginConfigurationFlow - é…ç½®æµç¨‹
   - needsConfiguration: boolean
   - configure: (context) => Promise<PluginConfig>
   - getSummary: (config) => string[]

5. Plugin - æ’ä»¶ä¸»æ¥å£
   - meta: { name, commandName, version, description, recommended }
   - commands?: PluginCommand[]
   - configuration?: PluginConfigurationFlow
   - hooks?: PluginHooks

6. å…¶ä»–è¾…åŠ©ç±»å‹
   - CommandOption
   - PluginConfig
   - SharedConfig
   - ç­‰ç­‰...
\```

**è¦æ±‚**:
- æ‰€æœ‰æ¥å£éƒ½è¦æœ‰å®Œæ•´çš„ JSDoc æ³¨é‡Šï¼ˆä¸­æ–‡æˆ–è‹±æ–‡ï¼‰
- ä½¿ç”¨ TypeScript ä¸¥æ ¼ç±»å‹
- å‚è€ƒè®¾è®¡æ–‡æ¡£ä¸­çš„æ¥å£å®šä¹‰

#### Task 1.2: å®ç°æ’ä»¶æ³¨å†Œè¡¨ (src/plugin/registry.ts)

\```typescript
export class PluginRegistry {
  private plugins: Map<string, Plugin>;

  constructor() {
    this.plugins = new Map();
  }

  // æ³¨å†Œæ’ä»¶
  register(plugin: Plugin): void {
    // 1. éªŒè¯æ’ä»¶ï¼ˆvalidatePluginï¼‰
    // 2. æ£€æŸ¥åç§°å†²çª
    // 3. æ·»åŠ åˆ° Map
  }

  // è·å–æ’ä»¶
  get(name: string): Plugin {
    // è·å–æ’ä»¶ï¼Œä¸å­˜åœ¨æŠ›å‡ºé”™è¯¯
  }

  // è·å–æ‰€æœ‰æ’ä»¶
  getAll(): Plugin[] {
    return Array.from(this.plugins.values());
  }

  // æ£€æŸ¥æ’ä»¶æ˜¯å¦å­˜åœ¨
  has(name: string): boolean {
    return this.plugins.has(name);
  }

  // è·å–å·²å¯ç”¨çš„æ’ä»¶
  getEnabled(config: CoreConfig): Plugin[] {
    // æ ¹æ®é…ç½®è¿‡æ»¤å·²å¯ç”¨çš„æ’ä»¶
  }

  // ç§æœ‰æ–¹æ³•ï¼šéªŒè¯æ’ä»¶
  private validatePlugin(plugin: Plugin): void {
    // éªŒè¯å¿…éœ€å­—æ®µ
    // éªŒè¯ commandName å”¯ä¸€æ€§
  }
}
\```

**æµ‹è¯•è¦æ±‚**:
- æµ‹è¯•æ³¨å†Œã€æŸ¥è¯¢ã€è¿‡æ»¤
- æµ‹è¯•é‡å¤æ³¨å†Œé”™è¯¯
- æµ‹è¯•ä¸å­˜åœ¨æ’ä»¶é”™è¯¯

#### Task 1.3: å®ç°æ’ä»¶åŠ è½½å™¨ (src/plugin/loader.ts)

\```typescript
export class PluginLoader {
  private registry: PluginRegistry;
  private loadedPlugins: Map<string, Plugin>;

  constructor(registry: PluginRegistry) {
    this.registry = registry;
    this.loadedPlugins = new Map();
  }

  // åŠ è½½æ’ä»¶
  async load(config: CoreConfig, context: PluginContext): Promise<void> {
    // 1. è·å–å·²å¯ç”¨æ’ä»¶
    // 2. æ‹“æ‰‘æ’åºï¼ˆå¤„ç†ä¾èµ–ï¼‰
    // 3. é€ä¸ªåŠ è½½
  }

  // æ‰§è¡Œç”Ÿå‘½å‘¨æœŸé’©å­
  async executeHook(
    hookName: keyof PluginHooks,
    context: PluginContext
  ): Promise<void> {
    // æŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰å·²åŠ è½½æ’ä»¶çš„æŒ‡å®šé’©å­
  }

  // æ‹“æ‰‘æ’åºï¼ˆå¤„ç†æ’ä»¶ä¾èµ–ï¼‰
  private sortByDependencies(plugins: Plugin[]): Plugin[] {
    // å®ç°æ‹“æ‰‘æ’åº
    // æ£€æµ‹å¾ªç¯ä¾èµ–
    // è¿”å›æ’åºåçš„æ’ä»¶åˆ—è¡¨
  }
}
\```

**æ‹“æ‰‘æ’åºç®—æ³•**:
ä½¿ç”¨ Kahn ç®—æ³•æˆ– DFS å®ç°ï¼Œæ£€æµ‹å¾ªç¯ä¾èµ–ã€‚

**æµ‹è¯•è¦æ±‚**:
- æµ‹è¯•ä¾èµ–æ’åº
- æµ‹è¯•å¾ªç¯ä¾èµ–æ£€æµ‹
- æµ‹è¯•é’©å­æ‰§è¡Œé¡ºåº

#### Task 1.4: å®ç°æ’ä»¶ä¸Šä¸‹æ–‡ (src/plugin/context.ts)

\```typescript
export async function createPluginContext(
  projectRoot: string,
  config: CoreConfig
): Promise<PluginContext> {
  return {
    projectRoot,
    targetDir: projectRoot,
    config: {
      core: config,
      plugins: new Map()
    },
    shared: new Map(),
    logger: createLogger(),
    fs: createFileOperations(),
    template: createTemplateEngine(),
    // ui å’Œ i18n æš‚æ—¶ç•™ç©ºï¼Œåç»­é›†æˆ
    ui: {} as UIComponents,
    i18n: {} as I18nAPI
  };
}

// è¾…åŠ©å‡½æ•°
function createLogger(): Logger {
  // ä½¿ç”¨ç°æœ‰çš„ utils/logger.ts
}

function createFileOperations(): FileOperations {
  // å°è£…ç°æœ‰çš„ utils/file-ops.ts
}

function createTemplateEngine(): TemplateEngine {
  // ä½¿ç”¨ç°æœ‰çš„ core/template-engine.ts
}
\```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰ç±»å‹å®šä¹‰å®Œæ•´ä¸”æ­£ç¡®
- [ ] PluginRegistry åŠŸèƒ½å®Œæ•´
- [ ] PluginLoader ä¾èµ–æ’åºæ­£ç¡®
- [ ] æ’ä»¶ä¸Šä¸‹æ–‡åˆ›å»ºæ­£ç¡®
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç æœ‰æ¸…æ™°çš„æ³¨é‡Š

**ç°æœ‰ä»£ç å¤ç”¨**:
- `src/utils/logger.ts` - æ—¥å¿—å·¥å…·
- `src/utils/file-ops.ts` - æ–‡ä»¶æ“ä½œ
- `src/core/template-engine.ts` - æ¨¡æ¿å¼•æ“

**è¾“å‡ºæ¸…å•**:
1. src/plugin/types.ts
2. src/plugin/registry.ts
3. src/plugin/loader.ts
4. src/plugin/context.ts
5. tests/plugin/registry.test.ts
6. tests/plugin/loader.test.ts
7. tests/plugin/context.test.ts
8. å®ç°æŠ¥å‘Šï¼ˆä½¿ç”¨æ ‡å‡†æ¨¡æ¿ï¼‰

**é¢„è®¡æ—¶é—´**: 2-3 å¤©

å¼€å§‹å·¥ä½œï¼Œå®Œæˆåå‘æˆ‘è¯¦ç»†æ±‡æŠ¥ã€‚

---

[ä¸ºå…¶ä»– 3 ä¸ª subagent ç¼–å†™ç±»ä¼¼çš„è¯¦ç»† prompt...]
```

---

## æˆåŠŸæ ‡å‡†

### æ•´ä½“ç›®æ ‡

- âœ… æ‰€æœ‰ Phase 1-9 ä»»åŠ¡å®Œæˆ
- âœ… Extra 1-2 è®¾è®¡æ–‡æ¡£å®Œæˆ
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆè¦†ç›–ç‡ > 80%ï¼‰
- âœ… ä¸¤ç§è¯­è¨€éƒ½å¯æ­£å¸¸ä½¿ç”¨
- âœ… èƒ½å¤Ÿå®Œæ•´åˆå§‹åŒ–é¡¹ç›®
- âœ… `memory system-add` å‘½ä»¤èƒ½åˆ›å»º PR
- âœ… æ–‡æ¡£å®Œæ•´æ›´æ–°

### è´¨é‡æŒ‡æ ‡

- Code Coverage > 80%
- TypeScript 0 errors
- ESLint 0 errors
- All tests passing
- 2 languages supported
- 0 breaking changes in plugin API

---

**åˆ›å»ºæ—¥æœŸ**: 2025-01-18
**ç»´æŠ¤è€…**: ä¸»æ§ Agent
**çŠ¶æ€**: Ready to orchestrate
